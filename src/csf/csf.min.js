/*
	@app                        ConfigServer Firewall (csf)
	@author						Copyright (C) 2025 Aetherinox
								Copyright (C) 2006-2025 Jonathan Michaelson
	@license                    GPLv3
	@repo_primary             	https://github.com/Aetherinox/csf-firewall/actions
	@repo_legacy              	https://github.com/waytotheweb/scripts
	@file						cjs.min.js
*/

document.addEventListener( 'DOMContentLoaded', () =>
{

	/*
		csfapp › dropdown
	*/

	document.addEventListener( 'click', function(e)
	{
		var a = e.target.closest && e.target.closest( '.form-csfapp-dropdown .dropdown-menu a' );
		if (!a) return;
	
		e.preventDefault();
		var value = a.getAttribute( 'data-value' );
		var form = a.closest( '.form-csfapp-dropdown' );
		if (!form) return;
	
		var hid = form.querySelector( 'input[name="csfapp"]' );
		if (hid)
		{
			hid.value = value;
			console.log( 'Hidden input updated → csfapp=' + hid.value);
		}
	
		var sel = form.querySelector( '.selected-text' );
		if (sel)
		{
			sel.textContent = value;
			console.log( 'Displayed text updated → ' + value );
		}
	}, false);
	
	/*
		csfapp › Catch form submissions
	*/

	document.addEventListener( 'submit', function( e )
	{
		var form = e.target.closest( '.form-csfapp-dropdown' );
		if (form)
		{
			var hid = form.querySelector( 'input[name="csfapp"]' );
			if (hid)
			{
				console.log( 'Form will submit csfapp=' + hid.value );
			}
		}
	}, false);

			});
		}
	
		/*
			Footer › Button › Switch Theme
		*/
	
		const toggleBtn = document.getElementById('btn-theme');
		const html = document.documentElement;
	
		// Load saved theme or fallback to light
		const savedTheme = localStorage.getItem('theme') || 'light';
		html.setAttribute('data-theme', savedTheme);
	
		// Function to update button icon + tooltip
		function updateButton(theme)
		{
			if (theme === 'dark')
			{
				toggleBtn.innerHTML = '<i class="ax-solid ax-sun"></i>';
				toggleBtn.setAttribute('title', 'Switch to Light Theme');
			}
			else
			{
				toggleBtn.innerHTML = '<i class="ax-solid ax-moon"></i>';
				toggleBtn.setAttribute('title', 'Switch to Dark Theme');
			}
		}
	
		// Initial load
		updateButton( savedTheme );
	
		// Handle click
		toggleBtn.addEventListener( 'click', () =>
		{
			const current = html.getAttribute( 'data-theme' );
			const next = current === 'dark' ? 'light' : 'dark';
	
			html.setAttribute( 'data-theme', next );
			localStorage.setItem( 'theme', next );
	
			updateButton( next );
		});
	
		/*
			Footer › Button › Logout
				Sync logout link from header to footer
		*/
	
		const headerLogout = document.querySelector('.pull-right a[href*="csfaction=csflogout"]');
		const footerLogout = document.getElementById('btn-logout');
	
		if (headerLogout && footerLogout)
		{
			const logoutHref = headerLogout.getAttribute('href');
	
			footerLogout.addEventListener('click', () =>
			{
				window.location.href = logoutHref;
			});
	
			footerLogout.setAttribute('title', 'Logout of CSF');
		}
	
		/*
			Footer › Button › Github
		*/
	
		const githubBtn = document.getElementById( 'btn-github' );
		if (githubBtn)
		{
			githubBtn.setAttribute( 'title', 'Visit Github repo' );
			githubBtn.addEventListener( 'click', () =>
			{
				window.open( 'https://github.com/Aetherinox/csf-firewall', '_blank' );
			});
		}
	
	});
				